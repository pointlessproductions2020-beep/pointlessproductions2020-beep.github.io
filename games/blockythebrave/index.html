<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blocky the Brave</title>
  <style>
    canvas { background: #eef; display: block; margin: 0 auto; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let keys = {};
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

// Modular character made of blocks
const blocky = {
  x: 100, y: 300,
  vx: 2, vy: 0,
  gravity: 0.5,
  jumpPower: -10,
  grounded: false,
  blocks: [
    { dx: 0, dy: -30 }, // Head
    { dx: -10, dy: 0 }, // Left arm
    { dx: 0, dy: 0 },   // Body
    { dx: 10, dy: 0 },  // Right arm
    { dx: -5, dy: 30 }, // Left leg
    { dx: 5, dy: 30 }   // Right leg
  ]
};

const platforms = [
  { x: 0, y: 350, width: 800, height: 50 },
  { x: 200, y: 300, width: 100, height: 20 },
  { x: 400, y: 250, width: 100, height: 20 },
];

const coin = { x: 600, y: 220, radius: 10, collected: false };

function collide(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

function update() {
  blocky.vy += blocky.gravity;
  blocky.x += blocky.vx;
  blocky.y += blocky.vy;

  blocky.grounded = false;
  for (let plat of platforms) {
    const playerRect = {
      x: blocky.x, y: blocky.y, width: 20, height: 40
    };
    if (collide(playerRect, plat)) {
      if (blocky.vy > 0) {
        blocky.y = plat.y - 40;
        blocky.vy = 0;
        blocky.grounded = true;
      }
    }
  }

  if (keys['Space'] && blocky.grounded) {
    blocky.vy = blocky.jumpPower;
  }

  // Coin collection
  const dx = blocky.x - coin.x;
  const dy = blocky.y - coin.y;
  if (Math.sqrt(dx*dx + dy*dy) < coin.radius + 20) {
    coin.collected = true;
  }
}

function drawCharacter(baseX, baseY, time) {
  ctx.fillStyle = 'red';
  blocky.blocks.forEach((block, i) => {
    let offsetY = block.dy;
    if (i >= 4) {
      offsetY += Math.sin(time / 200 + i) * 5; // Leg animation
    }
    ctx.fillRect(baseX + block.dx, baseY + offsetY, 10, 10);
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Platforms
  ctx.fillStyle = 'green';
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));

  // Coin
  if (!coin.collected) {
    ctx.fillStyle = 'gold';
    ctx.beginPath();
    ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
    ctx.fill();
  }

  // Character
  drawCharacter(blocky.x, blocky.y, performance.now());
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
